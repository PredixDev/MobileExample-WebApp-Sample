<html>
<head>
<style type="text/css">
div {padding:10 10 0 10;}
input {margin:10 0 0 0;}
div.inline { float:left;}
.clearBoth { clear:both; }
</style>
</head>
<body>
<div>
Setup Offline Login
</div>
<div class="inline">
User: 
</div>
<div id="userName">
</div>
<div class="inline">
Create Password:
</div
<div>
<input type="password" id="pass">
</div>
<div class="inline">
Confirm Password:
</div
<div>
<input type="password" id="confirmPass">
</div>

<div>
<input type="button" id="okButton" value="OK" onclick='buttonClick()'>
</div>
<script lang='javascript' type="text/javascript">
//<![CDATA[
  
  var token
  
  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
    results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }
  
  function buttonClick(){
    console.log("OK button clicked")
    var xmlhttp = new XMLHttpRequest();
    
    var pass = document.getElementById('pass').value;
    var confirm = document.getElementById('confirmPass').value;
    
    if (pass != confirm)
    {
       alert("New password and confirm does not match");
    }
    else
    {
		var url =   "http://pmapi/auth/" + token + "/setup?p=" + pass
		
		xmlhttp.open("PUT",url, true);
		xmlhttp.setRequestHeader("Content-type","application/json;charset=UTF-8");
		xmlhttp.setRequestHeader("Content-length", 0);
		xmlhttp.send();
	}
  }
  
  function start() {
  	var user = getParameterByName("u")
  	token = getParameterByName("t")
  	var userDiv = document.getElementById('userName');
  	userDiv.innerHTML = user
  }  
  
  start()
//]]>
</script>
</body>
</html>